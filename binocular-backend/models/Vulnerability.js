'use strict';

import _ from 'lodash';
import Model from './Model.js';
import IllegalArgumentError from '../errors/IllegalArgumentError.js';

const Vulnerability = Model.define('Vulnerability', {
  attributes: [
    'vulnId',
    'severity',
    'advisoryUrl',
    'cve',
    'affectedVersions',
    'patchedVersions',
    'title',
    'description',
    'publishedAt',
    'lastModifiedAt',
  ],
  keyAttribute: 'vulnId',
});

Vulnerability.persist = function (_vulnData) {
  const vulnData = _.clone(_vulnData);

  if (!vulnData.vulnId) {
    throw new IllegalArgumentError('Vulnerability requires vulnId!');
  }

  vulnData.vulnId = vulnData.vulnId.toString();

  return Vulnerability.ensureById(vulnData.vulnId, vulnData, {
    ignoreUnknownAttributes: true,
  });
};

export default Vulnerability;
